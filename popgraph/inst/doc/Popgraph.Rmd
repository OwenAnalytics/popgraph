<!-- 
%\VignetteEngine{knitr}
%\VignetteIndexEntry{Popgraphs}
-->

<link href="http://dyerlab.bio.vcu.edu/media/dyerlab.doc.css" rel="stylesheet"></link>

Popgraphs
========================================================

<!--  Some preamble stuff for knitr  -->
```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(out.extra='style="display:block; margin: auto"', fig.align="center")
```


Introdution
-----------

The **popgraph** package is designed to take multivariate data and construct a Population Graph (Dyer & Nason 2004).  This is a graph-theoretic interpretation of genetic covariance and serves as a tool for understanding underlying evolutionary history for a set of populations.  

These routines were originally in the **gstudio** package but were excised out for simplicity. This analysis is *not* limited solely to genetic data and can be used generally for many types of analyses.  As such, I pulled this out of the genetic package and allow it to remain on its own.  To get your data using **gstudio** with genotypes and such into a format for this package, translate the genotypes into their multivariate format as:

```{r,echo=TRUE,eval=FALSE}
data <- as.matrix( my_genetic_data )
```

For more information on this, see the documentation on the **gstudio** package (a copy is mirrored at http://dyerlab.bio.vcu.edu/ and a clone of the package can be checked out at https://github.com/dyerlab/gstudio)


Creating Population Graphs
--------------------------

There are two ways to create a population graph:

1. In this package using the function *population_graph()* and,
+  Via the servers at http://dyerlab.bio.vcu.edu (which use this packages to do the translation) or via GeneticStudio (an older software package)


```{r,message=FALSE}
require(popgraph)
```



### Creating *De Novo* Graphs

Here we will focus on the former approach as it is native to this package.  If you use the latter one, it will produce a *.pgraph file and you can read it in using 

```{r}
A <- matrix(0, nrow=4, ncol=4)
A[1,2] <- A[2,3] <- A[1,3] <- A[3,4] <- 1
A <- A + t(A)
A
```


```{r}
g <- graph.adjacency( A, mode="undirected" )
```

There are several options available under the *mode* parameter.  We typically use the undirected graph option but the following are also available:

1. *undirected* The connections between nodes are symmetric.  This is the default for population graphs as covariance, the quantity the edge is representing is symmetrical.
+ *directed* The edges are asymetric.
+ *max* or *min* Will take the largest (or smallest) value of the matrix (e.g., $max(A[i,j], A[j,i])$ or $min( A[i,j], A[j,i])$ ).
+ *upper* or *lower* Uses either the upper or lower element of the matrix.
+ *plus* Adds upper and lower values (e.g., $A[i,j] + A[j,i]$).

There are many other ways to create *igraph* objects *de novo* but this is the easiest method.


#### Node &amp; Edge Attributes

The underlying structure of an *igraph* object allows you to assoicate attributes (e.g., other data) with nodes and edges. Node attributes are accessed using the $V(graph)$ operator (for vertex) and edge attributes are done via $E(graph)$.  Attributes can be set as well as retrieved using the same mechanisms.

```{r}
V(g)$name <- LETTERS[1:4]
V(g)$group <- c("Baja","Baja","Sonora","Sonora")
list.vertex.attributes( g )
V(g)$names
```


```{r}
E(g)
E(g)$color <- c("red","red", "red", "blue")
list.edge.attributes( g )
```



### Plotting a graph

One of the main benefits to using 


```{r}
plot(g, vertex.label=V(g)$name)
```


### Reading Existing Popgraph Files


The online versions of Population Graphs provides a *.pgraph file for visualization. These files are visualized in several different software platforms including GeneticStudio (Dyer 2009), a OpenGL visualization application (Dyer &amp; Nason 2004), an online visualization framework at http://dyerlab.bio.vcu.edu, and of course, in R.  We shall focus on this last one.  Reading in files to R 

```{r,eval=FALSE,echo=TRUE}
graph <- read.popgraph( "thegraph.pgraph" )
```




```{r}
data(lopho)
class(lopho)
summary(lopho)
```





### Saving Population Graph Objects


A *popgraph* object is a normal R object and can be saved using the normal R mechanisms.

```{r,echo=TRUE,eval=FALSE}
save( lopho, file="MyLophoGraph.rda")
```


For interoperability, popgraph objects can also be saved in other formats.


Mapping Population Graphs
-------------------------





### Saving to Spatial* Data Object from **sp**







Testing for Topological Congruence
----------------------------------

If you have more than one topology and the node sets overlap sufficiently, you can test for the topological congruence of the two.  There are several specific reasons why population graph topologies may be congruent.  In this section we use the spatial genetic structure of the Senita cactus (*Lophocereus schottii*) and its obligate pollinator, *Upiga virescens* as an example.  This is an obligate pollination mutualism and as such we should expect there to be some degree of sptial genetic congruence between the species due to this coevolution.  








Extracting Graph-Theoretic Parameters
-------------------------------------

The underlying structure of a popgraph object is based upon the **igraph** package from Gabor Csardi.  A population graph is essentially a specific kind of *igraph* object and can be decorated with metadata that is useful for spatial population genetic analyses.  As such, there is a wealth of existing analyses from both the **igraph** as well as the **sna** packages that can be used on popgraph objects.  Here are some examples.

### Matrix Representations of Population Graph Objects



### Node Specific Parameters




### Edge Specific Parameters












References
----------

Dyer RJ, Nason JD. 2004. Population Graphs: the graph theoretic shape of genetic structure. *Molecular Ecology*, **13** 1713-1727.
